---
# Dynamically Generated Charts
common:
  repoURL: https://github.com/uc2-io/uc2-gitops.git
  targetRevision: main
  namespace: uc2-openshift-gitops
  project: stack-apps
  destinationNamespace: uc2-openshift-gitops
  prune: true
  selfHeal: true
global:
  use_infra_nodes: false
charts:
  # Cluster Specific Configuration
  stack-apps:
    name: stack-apps
    path: charts/application-manager
    values:
      common:
        destinationNamespace: uc2-openshift-gitops
        namespace: uc2-openshift-gitops
        project: stack-apps
        prune: true
        repoURL: https://github.com/uc2-io/uc2-gitops.git
        selfHeal: true
        targetRevision: main
      charts:
        # Configure Static Node Labels
        static-node-config:
          name: static-node-config
          path: charts/static-node-config
          annotations:
            argocd.argoproj.io/sync-wave: "-1"
          syncOptions:
            - ServerSideApply=true
          values:
            nodes:
              - name: in0.warden.lab.uc2.io
                labels:
                  cluster.ocs.openshift.io/openshift-storage: ""
                  nmstate.apps.uc2.io/vmware: ""
                  stack.apps.uc2.io/cnv-infra: ""
              - name: in1.warden.lab.uc2.io
                labels:
                  cluster.ocs.openshift.io/openshift-storage: ""
                  nmstate.apps.uc2.io/vmware: ""
                  stack.apps.uc2.io/cnv-infra: ""
              - name: in2.warden.lab.uc2.io
                labels:
                  cluster.ocs.openshift.io/openshift-storage: ""
                  nmstate.apps.uc2.io/vmware: ""
                  stack.apps.uc2.io/cnv-infra: ""
              - name: metal0.warden.lab.uc2.io
                labels:
                  nmstate.apps.uc2.io/metal: ""
              - name: metal1.warden.lab.uc2.io
                labels:
                  nmstate.apps.uc2.io/metal: ""
              - name: wk0.warden.lab.uc2.io
                labels:
                  nmstate.apps.uc2.io/vmware: ""
                  stack.apps.uc2.io/aap: ""
                  stack.apps.uc2.io/quay: ""
              - name: wk1.warden.lab.uc2.io
                labels:
                  nmstate.apps.uc2.io/vmware: ""
                  stack.apps.uc2.io/aap: ""
                  stack.apps.uc2.io/quay: ""
              - name: wk2.warden.lab.uc2.io
                labels:
                  nmstate.apps.uc2.io/vmware: ""
                  stack.apps.uc2.io/aap: ""
                  stack.apps.uc2.io/quay: ""
        # Deploy OpenShift Kubernetes Descheduler Operator
        descheduler-operator:
          name: descheduler-operator
          path: charts/operator
          annotations:
            argocd.argoproj.io/sync-wave: "1"
          destinationNamespace: openshift-kube-descheduler-operator
          values:
            namespace:
              enabled: true
              namespaces:
                - labels:
                    openshift.io/cluster-monitoring: "true"
                  name: openshift-kube-descheduler-operator
            operator:
              channel: stable
              installPlanApproval: Automatic
              name: cluster-kube-descheduler-operator
              source: redhat-operators
              sourceNamespace: openshift-marketplace
            operatorgroup:
              clusterScope: false
              create: true
        # Deploy OpenShift Virtualization Operator
        cnv-operator:
          name: cnv-operator
          path: charts/operator
          annotations:
            argocd.argoproj.io/sync-wave: "1"
          destinationNamespace: openshift-cnv
          values:
            config:
              nodeSelector:
                stack.apps.uc2.io/cnv-infra: ""
            namespace:
              enabled: true
              namespaces:
                - name: openshift-cnv
                  skip_common_labels: true
            operator:
              channel: stable
              installPlanApproval: Automatic
              name: kubevirt-hyperconverged
              source: redhat-operators
              sourceNamespace: openshift-marketplace
            operatorgroup:
              clusterScope: false
              create: true
        # Deploy Migration Toolkit for VIrtualization Operator
        mtv-operator:
          name: mtv-operator
          path: charts/operator
          annotations:
            argocd.argoproj.io/sync-wave: "1"
          destinationNamespace: openshift-mtv
          values:
            config:
              nodeSelector:
                stack.apps.uc2.io/cnv-infra: ""
            namespace:
              enabled: true
              namespaces:
                - name: openshift-mtv
                  skip_common_labels: true
            operator:
              channel: release-v2.7
              installPlanApproval: Automatic
              name: mtv-operator
              source: redhat-operators
              sourceNamespace: openshift-marketplace
            operatorgroup:
              clusterScope: false
              create: true
        # Deploy ODF Operator
        odf-operator:
          name: odf-operator
          path: charts/operator
          annotations:
            argocd.argoproj.io/sync-wave: "1"
          destinationNamespace: openshift-storage
          values:
            namespace:
              enabled: true
              namespaces:
                - labels:
                    openshift.io/cluster-monitoring: "true"
                  name: openshift-storage
            operator:
              channel: stable-4.16
              installPlanApproval: Automatic
              name: odf-operator
              source: redhat-operators
              sourceNamespace: openshift-marketplace
            operatorgroup:
              clusterScope: false
              create: true
        # Deploy Local Storage Operator
        local-storage-operator:
          name: local-storage-operator
          path: charts/operator
          annotations:
            argocd.argoproj.io/sync-wave: "1"
          destinationNamespace: openshift-local-storage
          values:
            namespace:
              enabled: true
              namespaces:
                - labels:
                    openshift.io/cluster-monitoring: "true"
                  name: openshift-local-storage
            operator:
              channel: stable
              installPlanApproval: Automatic
              name: local-storage-operator
              source: redhat-operators
              sourceNamespace: openshift-marketplace
            operatorgroup:
              clusterScope: false
              create: true
        # Deploy NNCP For Virtrual Workloads
        nncp:
          name: nmstate-nncp
          path: charts/nncp
          annotations:
            argocd.argoproj.io/sync-wave: "3"
          valueFiles:
            - ../../values/clusters/files/warden/virt-networking.yaml
        # Deploy Local Volume Set for OpenShift Data Foundation (OSD)
        odf-lvs-osd:
          name: odf-lvs-osd
          path: charts/stack/odf-lvs
          annotations:
            argocd.argoproj.io/sync-wave: "3"
          destinationNamespace: openshift-local-storage
          values:
            lvs_nodeselectorterms:
              - matchExpressions:
                - key: kubernetes.io/hostname
                  operator: In
                  values:
                  - in0.warden.lab.uc2.io
                  - in1.warden.lab.uc2.io
                  - in2.warden.lab.uc2.io
            lvs_storageclass: odf-osd-localvolumeset
        # Deploy OpenShift Data Foundation
        odf-storagecluster:
          name: odf-storagecluster
          path: charts/stack/odf
          annotations:
            argocd.argoproj.io/sync-wave: "4"
          destinationNamespace: openshift-storage
          values:
            ansible-runner-job:
              enabled: true
              jobs:
                - annotations:
                    argocd.argoproj.io/hook: PreSync
                    argocd.argoproj.io/hook-delete-policy: HookSucceeded
                  ansible_extravars_json: >-
                    {
                      "lvs_expected_pv_count": 3,
                      "lvs_name": "odf-osd-localvolumeset",
                      "lvs_namespace": "openshift-local-storage",
                      "lvs_storageclass": "odf-osd-localvolumeset"
                    }
                  ansible_playbook: ansible/job-prehook-validate-lvs.yaml
                  git_branch: main
                  name: prehook-validate-lvs
                - annotations:
                    argocd.argoproj.io/hook: PostSync
                    argocd.argoproj.io/hook-delete-policy: HookSucceeded
                  ansible_extravars_json: >-
                    {
                      "additional_plugins": [
                        "odf-console"
                      ]
                    }
                  ansible_playbook: ansible/job-posthook-console-plugin.yaml
                  git_branch: main
                  name: posthook-odf-console-plugin
            storagecluster_enabledefaultstorageclass: true
            storagecluster_multus_enable: false
            storagecluster_storage: 1000Gi
            storagecluster_storageclass: odf-osd-localvolumeset
            storagecluster_use_localstorage: true
            storagecluster_version: "4.16.0"
        # Configure OpenShift Internal Image Registry
        registry:
          annotations:
            argocd.argoproj.io/sync-wave: "5"
          name: registry
          path: charts/registry
          values:
            registry_default_route: true
            registry_pvc_storage_class: odf-storagecluster-ceph-rbd
        # Deploy OpenShift Virtualization
        cnv:
          name: cnv
          path: charts/stack/cnv
          annotations:
            argocd.argoproj.io/sync-wave: "6"
          destinationNamespace: openshift-cnv
        # Deploy Migration Toolkit for Virtualization
        mtv:
          name: mtv
          path: charts/stack/mtv
          annotations:
            argocd.argoproj.io/sync-wave: "7"
          destinationNamespace: openshift-cnv
